# ShirokoBot

ä¸€ä¸ªåŸºäº Java çš„å¤šåè®® QQ æœºå™¨äººæ¡†æ¶ï¼Œæ”¯æŒ OneBot V11 å’Œ Milky åè®®ã€‚

[![Java](https://img.shields.io/badge/Java-17+-orange.svg)](https://www.java.com/)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://www.apache.org/licenses/LICENSE-2.0)
[![Version](https://img.shields.io/badge/Version-1.1--SNAPSHOT-green.svg)](https://github.com/BaicaijunOvO/ShirokoBot)

## ç‰¹æ€§

- ğŸ”Œ **å¤šåè®®æ”¯æŒ**ï¼šåŒæ—¶æ”¯æŒ OneBot V11 å’Œ Milky åè®®
- ğŸ§© **æ’ä»¶ç³»ç»Ÿ**ï¼šç±»ä¼¼ Bukkit çš„æ’ä»¶æ¶æ„ï¼Œæ”¯æŒçƒ­åŠ è½½
- ğŸ“ **äº‹ä»¶é©±åŠ¨**ï¼šå®Œæ•´çš„äº‹ä»¶ç³»ç»Ÿï¼Œæ”¯æŒä¼˜å…ˆçº§å’Œå–æ¶ˆæœºåˆ¶
- âš¡ **å¼‚æ­¥æ¶ˆæ¯**ï¼šåŸºäº CompletableFuture çš„å¼‚æ­¥æ¶ˆæ¯å‘é€
- ğŸ¨ **æ¶ˆæ¯æ®µæ”¯æŒ**ï¼šæ”¯æŒ CQ ç å’Œ MILKY ç æ ¼å¼
- ğŸ”„ **è‡ªåŠ¨é‡è¿**ï¼šWebSocket è¿æ¥æ–­å¼€è‡ªåŠ¨é‡è¿
- ğŸ“Š **æ—¥å¿—ç³»ç»Ÿ**ï¼šå®Œå–„çš„æ—¥å¿—è®°å½•å’Œæ’ä»¶æ—¥å¿—éš”ç¦»

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Java 17 æˆ–æ›´é«˜ç‰ˆæœ¬
- Gradle 7.0+ (å¯é€‰ï¼Œé¡¹ç›®åŒ…å« Gradle Wrapper)

### æ„å»ºé¡¹ç›®

```bash
# Windows
gradlew.bat build

# Linux/Mac
./gradlew build
```

### è¿è¡Œ

```bash
# Windows
gradlew.bat run

# Linux/Mac
./gradlew run
```

## æ’ä»¶å¼€å‘

### åˆ›å»ºæ’ä»¶é¡¹ç›®

TODO ä¹‹åå†è¯´

### æ’ä»¶ä¸»ç±»

```java
package com.example.myplugin;

import ovo.baicaijun.ShirokoBot.Plugins.Plugin;
import ovo.baicaijun.ShirokoBot.Plugins.Event.EventManager;
import ovo.baicaijun.ShirokoBot.Plugins.Command.CommandManager;

public class MyPlugin extends Plugin {
    
    @Override
    public void onLoad() {
        log("æ’ä»¶æ­£åœ¨åŠ è½½...");
    }
    
    @Override
    public void onEnable() {
        log("æ’ä»¶å·²å¯ç”¨ï¼");
        
        // æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
        EventManager.registerEvents(new MyListener(this), this);
        
        // æ³¨å†Œå‘½ä»¤
        CommandManager.registerCommand(this, new MyCommand());
    }
    
    @Override
    public void onDisable() {
        log("æ’ä»¶å·²ç¦ç”¨");
    }
}
```

### äº‹ä»¶ç›‘å¬å™¨

```java
package com.example.myplugin;

import ovo.baicaijun.ShirokoBot.Plugins.Event.*;
import ovo.baicaijun.ShirokoBot.Plugins.Plugin;

public class MyListener implements Listener {
    
    private final Plugin plugin;
    
    public MyListener(Plugin plugin) {
        this.plugin = plugin;
    }
    
    @EventHandler(priority = EventPriority.NORMAL)
    public void onMessage(MessageReceiveEvent event) {
        String message = event.getRawMessage();
        
        if (message.equals("hello")) {
            event.sendMessage("Hello, World!")
                .thenAccept(receipt -> {
                    if (receipt.isSuccess()) {
                        plugin.log("æ¶ˆæ¯å‘é€æˆåŠŸ: " + receipt.getMessageId());
                    }
                });
        }
    }
}
```

### å‘½ä»¤å¤„ç†

```java
package com.example.myplugin;

import ovo.baicaijun.ShirokoBot.Plugins.Command.Command;
import ovo.baicaijun.ShirokoBot.Plugins.Command.CommandSender;
import ovo.baicaijun.ShirokoBot.Plugins.Plugin;

public class MyCommand extends Command {
    
    public MyCommand() {
        super("mycommand");
        setDescription("æˆ‘çš„å‘½ä»¤");
        setUsage("/mycommand <å‚æ•°>");
    }
    
    @Override
    public boolean execute(CommandSender sender, String[] args) {
        Plugin plugin = getPlugin();
        
        if (args.length == 0) {
            sender.sendMessage("ç”¨æ³•: " + getUsage());
            return false;
        }
        
        sender.sendMessage("ä½ è¾“å…¥äº†: " + String.join(" ", args))
            .thenAccept(receipt -> {
                if (receipt.isSuccess()) {
                    plugin.log("å‘½ä»¤æ‰§è¡ŒæˆåŠŸ");
                }
            });
        
        return true;
    }
}
```

### æ’ä»¶æè¿°æ–‡ä»¶

åœ¨ `src/main/resources` åˆ›å»º `plugin.yml`ï¼š

```yaml
name: MyPlugin
version: 1.0.0
main: com.example.myplugin.MyPlugin
author: YourName
description: æˆ‘çš„ç¬¬ä¸€ä¸ªæ’ä»¶
```

### æ‰“åŒ…æ’ä»¶

```bash
mvn clean package
```

å°†ç”Ÿæˆçš„ JAR æ–‡ä»¶æ”¾å…¥ `plugins` ç›®å½•å³å¯ã€‚

## æ¶ˆæ¯æ®µä½¿ç”¨

### OneBot V11 (CQ ç )

```java
import ovo.baicaijun.ShirokoBot.OneBot.v11.MessageSegment;

// æ–‡æœ¬
String msg = MessageSegment.text("Hello");

// @æŸäºº
String msg = MessageSegment.at(123456) + " ä½ å¥½";

// å›¾ç‰‡
String msg = MessageSegment.image("file:///path/to/image.jpg");

// å›å¤
String msg = MessageSegment.reply(messageId) + "å›å¤å†…å®¹";
```

### Milky åè®®

```java
import ovo.baicaijun.ShirokoBot.Milky.MessageSegment;

// æ–‡æœ¬
String msg = MessageSegment.text("Hello");

// @æŸäºº
String msg = MessageSegment.at(123456) + " ä½ å¥½";

// @å…¨ä½“æˆå‘˜
String msg = MessageSegment.atAll();

// å›¾ç‰‡
String msg = MessageSegment.image("https://example.com/image.jpg");

// å›å¤
String msg = MessageSegment.reply(messageSeq) + "å›å¤å†…å®¹";
```

## æ”¯æŒçš„äº‹ä»¶

### é€šç”¨äº‹ä»¶

- `MessageReceiveEvent` - æ¶ˆæ¯æ¥æ”¶äº‹ä»¶
- `MessageSentEvent` - æ¶ˆæ¯å‘é€å›æ‰§äº‹ä»¶

### Milky ä¸“ç”¨äº‹ä»¶

- `FriendPokeEvent` - å¥½å‹æˆ³ä¸€æˆ³
- `FriendAddEvent` - å¥½å‹æ·»åŠ 
- `FriendDeleteEvent` - å¥½å‹åˆ é™¤
- `GroupAdminChangeEvent` - ç¾¤ç®¡ç†å‘˜å˜åŠ¨
- `GroupMemberIncreaseEvent` - ç¾¤æˆå‘˜å¢åŠ 
- `GroupMemberDecreaseEvent` - ç¾¤æˆå‘˜å‡å°‘
- `GroupMemberBanEvent` - ç¾¤æˆå‘˜ç¦è¨€
- `GroupPokeEvent` - ç¾¤å†…æˆ³ä¸€æˆ³
- `HeartbeatEvent` - å¿ƒè·³äº‹ä»¶

## API æ–‡æ¡£

### æ¶ˆæ¯å‘é€

```java
// é€šè¿‡äº‹ä»¶å‘é€
event.sendMessage("æ¶ˆæ¯å†…å®¹")
    .thenAccept(receipt -> {
        if (receipt.isSuccess()) {
            long messageId = receipt.getMessageId();
        } else {
            String error = receipt.getErrorMessage();
        }
    });

// é€šè¿‡ MessageApi å‘é€
MessageApi.send_msg(groupId, userId, "æ¶ˆæ¯å†…å®¹", botId)
    .thenAccept(receipt -> {
        // å¤„ç†ç»“æœ
    });
```

### æ¶ˆæ¯æ’¤å›

```java
MessageApi.delete_msg(groupId, userId, messageId, botId)
    .thenAccept(success -> {
        if (success) {
            plugin.log("æ’¤å›æˆåŠŸ");
        }
    });
```

## é¡¹ç›®ç»“æ„

```
TouchBot2/
â”œâ”€â”€ src/main/java/ovo/baicaijun/ShirokoBot/
â”‚   â”œâ”€â”€ Adapter/          # åè®®é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ MilkyAdapter.java
â”‚   â”‚   â””â”€â”€ OneBotV11Adapter.java
â”‚   â”œâ”€â”€ Bot/              # æ ¸å¿ƒ Bot åŠŸèƒ½
â”‚   â”œâ”€â”€ Config/           # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ Event/            # äº‹ä»¶å¤„ç†
â”‚   â”œâ”€â”€ Log/              # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ Milky/            # Milky åè®®å®ç°
â”‚   â”‚   â”œâ”€â”€ api/          # API è°ƒç”¨
â”‚   â”‚   â”œâ”€â”€ event/        # äº‹ä»¶å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ model/        # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ parser/       # æ¶ˆæ¯è§£æ
â”‚   â”œâ”€â”€ Network/          # ç½‘ç»œé€šä¿¡
â”‚   â”œâ”€â”€ OneBot/           # OneBot V11 å®ç°
â”‚   â””â”€â”€ Plugins/          # æ’ä»¶ç³»ç»Ÿ
â”‚       â”œâ”€â”€ Command/      # å‘½ä»¤ç³»ç»Ÿ
â”‚       â””â”€â”€ Event/        # äº‹ä»¶ç³»ç»Ÿ
â”œâ”€â”€ plugins/              # æ’ä»¶ç›®å½•
â””â”€â”€ config.json           # é…ç½®æ–‡ä»¶
```

## æŠ€æœ¯æ ˆ

- **Java 17+** - ç¼–ç¨‹è¯­è¨€
- **Jetty** - WebSocket æœåŠ¡å™¨
- **OkHttp** - HTTP å®¢æˆ·ç«¯
- **JSON** - æ•°æ®æ ¼å¼
- **Gradle** - æ„å»ºå·¥å…·

## å‚è€ƒé¡¹ç›®

- [OneBot V11](https://11.onebot.dev) - æœºå™¨äººåè®®æ ‡å‡†
- [Milky](https://milky.ntqqrev.org) - QQ æœºå™¨äººåè®®
- [Bukkit](https://bukkit.org) - æ’ä»¶ç³»ç»Ÿè®¾è®¡å‚è€ƒ

## å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0) å¼€æºåè®®ã€‚

## ä½œè€…

**BaicaijunOvO**

- GitHub: [@BaicaijunOvO](https://github.com/BaicaijunOvO)

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## æ›´æ–°æ—¥å¿—

### v1.1-SNAPSHOT

- âœ¨ æ–°å¢ Milky åè®®æ”¯æŒ
- âœ¨ å®Œå–„æ’ä»¶ç³»ç»Ÿ
- âœ¨ æ·»åŠ å¼‚æ­¥æ¶ˆæ¯å‘é€
- âœ¨ æ”¯æŒæ¶ˆæ¯å‘é€å›æ‰§
- ğŸ› ä¿®å¤æ’ä»¶æ—¥å¿—æ˜¾ç¤ºé—®é¢˜
- ğŸ”§ ä¼˜åŒ–äº‹ä»¶ç³»ç»Ÿæ€§èƒ½

### v1.0

- ğŸ‰ åˆå§‹ç‰ˆæœ¬
- âœ¨ æ”¯æŒ OneBot V11 åè®®
- âœ¨ åŸºç¡€æ’ä»¶ç³»ç»Ÿ
- âœ¨ å‘½ä»¤å’Œäº‹ä»¶ç³»ç»Ÿ
